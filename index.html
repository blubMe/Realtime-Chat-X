<!DOCTYPE html>
<html>

<head>
    <head><meta charset="utf-8" class="next-head next-head"><title class="jsx-551147592 next-head">Chatx</title><meta name="viewport" content="width=device-width, initial-scale=1.0" class="jsx-551147592 next-head"><meta name="twitter:card" content="summary" class="jsx-551147592 next-head"><meta name="twitter:site" content="@zeithq" class="jsx-551147592 next-head"><meta property="og:site_name" content="ZEIT Documentation" class="jsx-551147592 next-head"><meta property="og:type" content="website" class="jsx-551147592 next-head"><meta property="og:locale" content="en" class="jsx-551147592 next-head"><meta property="og:image" content="https://assets.zeit.co/image/upload/front/zeit/twitter-card.png" class="jsx-551147592 next-head"><link rel="apple-touch-icon" sizes="57x57" href="https://assets.zeit.co/image/upload/front/favicon/apple-touch-icon-57x57.png" class="jsx-551147592 next-head"><link rel="apple-touch-icon" sizes="60x60" href="https://assets.zeit.co/image/upload/front/favicon/apple-touch-icon-60x60.png" class="jsx-551147592 next-head"><link rel="apple-touch-icon" sizes="72x72" href="https://assets.zeit.co/image/upload/front/favicon/apple-touch-icon-72x72.png" class="jsx-551147592 next-head"><link rel="apple-touch-icon" sizes="76x76" href="https://assets.zeit.co/image/upload/front/favicon/apple-touch-icon-76x76.png" class="jsx-551147592 next-head"><link rel="apple-touch-icon" sizes="114x114" href="https://assets.zeit.co/image/upload/front/favicon/apple-touch-icon-114x114.png" class="jsx-551147592 next-head"><link rel="apple-touch-icon" sizes="120x120" href="https://assets.zeit.co/image/upload/front/favicon/apple-touch-icon-120x120.png" class="jsx-551147592 next-head"><link rel="apple-touch-icon" sizes="144x144" href="https://assets.zeit.co/image/upload/front/favicon/apple-touch-icon-144x144.png" class="jsx-551147592 next-head"><link rel="apple-touch-icon" sizes="152x152" href="https://assets.zeit.co/image/upload/front/favicon/apple-touch-icon-152x152.png" class="jsx-551147592 next-head"><link rel="apple-touch-icon" sizes="180x180" href="https://assets.zeit.co/image/upload/front/favicon/apple-touch-icon-180x180.png" class="jsx-551147592 next-head"><link rel="icon" type="image/png" href="https://assets.zeit.co/image/upload/front/favicon/favicon-32x32.png" sizes="32x32" class="jsx-551147592 next-head"><link rel="icon" type="image/png" href="https://assets.zeit.co/image/upload/front/favicon/android-chrome-192x192.png" sizes="192x192" class="jsx-551147592 next-head"><link rel="icon" type="image/png" href="https://assets.zeit.co/image/upload/front/favicon/favicon-96x96.png" sizes="96x96" class="jsx-551147592 next-head"><link rel="icon" type="image/png" href="https://assets.zeit.co/image/upload/front/favicon/favicon-16x16.png" sizes="16x16" class="jsx-551147592 next-head"><link rel="manifest" href="https://assets.zeit.co/raw/upload/front/front/favicon/manifest.json" class="jsx-551147592 next-head"><link rel="mask-icon" href="https://assets.zeit.co/image/upload/front/favicon/safari-pinned-tab.svg" color="#ffffff" class="jsx-551147592 next-head"><link rel="shortcut icon" href="https://assets.zeit.co/image/upload/front/favicon/favicon.ico" class="jsx-551147592 next-head">
</head>

<body>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font: 13px Helvetica, Arial;
            background: #231F20;
        }

        form {
            background: grey;
            padding: 10px;
            position: fixed;
            bottom: 0;
            width: 100%;
        }

        form input {
            border: 0;
            padding: 10px;
            width: 90%;
            margin-right: .5%;
        }
        @media only screen and (max-width: 768px){
            form input {
                width: 80vw;
            }
            form button {
                width: 50px!important;
            }
        }
        form button {
            width: 9%;
            background: rgb(130, 224, 255);
            border: none;
            padding: 10px;
        }

        #messages {
            list-style-type: none;
            margin: 0;
            padding-bottom: 60px;
            overflow-y: auto;
        }

        #messages li {
            padding: 5px 10px;
            color: red;
        }
        #messages p {
            color: orangered;
        }
        #messages li:nth-child(odd) {
            background: #eee;
            color: blue!important;
        }
    </style>
    <em id="feedback"></em>
    <ul id="messages"></ul>

    <form id="form_message" action="">
        <input id="m" autocomplete="off" />
        <button type="button">Send</button>
    </form>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.3/socket.io.min.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>

    <script>
        $(() => {
            console.log('app version: 0.0.1 Debug mode')
            console.log('maintained by Fahmi irsyad khairi')
            // declaration !!
            var socket = io()
            var message = $('#m')
            var feedback = $('#feedback')
            var sendMessage = $('#form_message')
            var chatlog = $('#messages')
            var canPublish = true
            var throttleTime = 200 // every .2 sec
            var clearInterval = 2000; // add interval when the client stop typing
            var clearTimerId; // free

            // Emit message
            sendMessage.submit((e) => {
                e.preventDefault();
                socket.emit('chat_message', {message: message.val()})
                message.val('')
            })

            // listening for new messages
            socket.on('chat_message',(data) =>{
                console.log(data)
                chatlog.append('<li>' + '⫸ [' + data.username + '] ● ' + data.message + '</li>')
            })

            //emit typing
            message.bind('keypress', (e) => {
                if(canPublish){
                    socket.emit('typing')
                    canPublish = false
                    setTimeout(() =>{
                        canPublish = true
                    }, throttleTime)
                }
            })

            //listening for typing
            socket.on('typing', (data) =>{
                feedback.html('<p><i>' + data.username + 'is typing...' + '</i></p>')

                //clear timeout typing
                clearTimeout(clearTimerId)
                clearTimerId = setTimeout(() =>{
                    feedback.html('')
                }, clearInterval)
            })
            /*
            $('form').submit(() => {
                socket.emit('chat message', $('#m').val())
                $('#m').val('')

                return false
            })
            socket.on('connected', function(){
                $('#messages').append($('<p style="color: green;">').text('ヽ(゜∇゜)ノ hello new incomers'))
            })
            socket.on('disconnect', function(){
                $('#messages').append($('<p>').text('oh shit fam ⊙﹏⊙, someone disconnected'))
            });
            var chat = io.connect('http://localhost:4000/');
            chat.on('connect', function () {
                console.log('Connected to the chat!');
                });
                chat.on('disconnect', function () {
                console.log('Disconnected from the chat!');
                });
            socket.on('chat message', msg => {
                $('#messages').append($('<li>').text('⫸ ●   ' + msg))
            })
            */
        })
    </script>
</body>

</html>